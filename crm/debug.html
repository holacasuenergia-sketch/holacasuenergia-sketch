<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRM Debug - Enerlux Soluciones</title>
</head>
<body>
  <h1>CRM Debug - Enerlux Soluciones</h1>
  
  <div>
    <h3>Test Firebase Auth</h3>
    <input type="email" id="email" placeholder="admin@enerlux.com" value="admin@enerlux.com">
    <input type="password" id="password" placeholder="enerlux123" value="enerlux123">
    <button onclick="testLogin()">Test Login</button>
    <button onclick="testLogout()">Test Logout</button>
  </div>
  
  <div>
    <h3>Debug Logs:</h3>
    <div id="logs" style="background: #f0f0f0; padding: 10px; border: 1px solid #ccc; min-height: 200px; font-family: monospace; font-size: 12px;">
      Logs will appear here...
    </div>
  </div>
  
  <div>
    <h3>Current Status:</h3>
    <div id="status" style="font-weight: bold; padding: 10px;">Not initialized</div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDLWicHjU6ji76EDIBeDO51Ivvf73Oc504",
      authDomain: "enerlux-crm.firebaseapp.com",
      projectId: "enerlux-crm",
      storageBucket: "enerlux-crm.firebasestorage.app",
      messagingSenderId: "84970919171",
      appId: "1:84970919171:web:a9904b377254bb26884536",
      measurementId: "G-LVY9D58L88"
    };

    let auth = null;

    function log(message) {
      const timestamp = new Date().toISOString();
      const logDiv = document.getElementById('logs');
      logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    function updateStatus(message) {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      console.log('STATUS:', message);
    }

    log('üìù Starting Firebase initialization...');

    try {
      firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      log('‚úÖ Firebase initialized successfully');
      log('‚ÑπÔ∏è Auth instance:', auth ? 'created' : 'NOT created');
    } catch (error) {
      log('‚ùå Firebase initialization ERROR:', error.message);
      log('   Full error:', error);
      updateStatus('ERROR: Firebase initialization failed');
    }

    log('‚ÑπÔ∏è Setting up auth state listener...');

    auth.onAuthStateChanged((user) => {
      if (user) {
        log('‚úÖ User is LOGGED IN:');
        log('   - Email:', user.email);
        log('   - UID:', user.uid ? user.uid.substring(0, 8) + '...' : 'N/A');
        log('   - Is email verified:', user.emailVerified);
        updateStatus('Logged in: ' + user.email);
      } else {
        log('‚ÑπÔ∏è User is NOT logged in (null user object)');
        updateStatus('Not logged in');
      }
    });

    async function testLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      
      log('üîê Trying to login with...');
      log('   - Email:', email);
      log('   - Password:', password ? '**** (present)' : 'MISSING');
      
      if (!email || !password) {
        log('‚ùå ERROR: Email or password is empty');
        return;
      }

      updateStatus('Logging in...');
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        log('‚úÖ Login SUCCESSFUL!');
        log('   - User:', userCredential.user.email);
        log('   - UID:', userCredential.user.uid.substring(0, 8) + '...');
        updateStatus('Logged in: ' + userCredential.user.email);
      } catch (error) {
        log('‚ùå Login ERROR:');
        log('   - Code:', error.code);
        log('   - Message:', error.message);
        log('   - Full error:', error);
        updateStatus('ERROR: ' + error.message);
      }
    }

    async function testLogout() {
      log('üì§ Logging out...');
      
      try {
        await auth.signOut();
        log('‚úÖ Logout SUCCESSFUL');
        updateStatus('Not logged in');
      } catch (error) {
        log('‚ùå Logout ERROR:');
        log('   - Message:', error.message);
        updateStatus('ERROR: ' + error.message);
      }
    }

    log('üìã Debug version loaded. Ready to test.');
    log('üí° Click "Test Login" button to test Firebase Auth.');
    updateStatus('Ready to test (not logged in)');
  </script>
</body>
</html>